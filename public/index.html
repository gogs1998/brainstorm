<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AI Brainstorm - Multi-Model Chat</title>
    <link rel="stylesheet" href="styles-fixed.css">
</head>
<body>
    <div class="app-container">
        <!-- Mobile Header -->
        <div class="mobile-header">
            <button id="menuToggle" class="menu-toggle">‚ò∞</button>
            <h1>üß† AI Brainstorm</h1>
        </div>

        <!-- Sidebar -->
        <div class="sidebar" id="sidebar">
            <div class="sidebar-header">
                <h1>üß† AI Brainstorm</h1>
                <button id="newChatBtn" class="btn-primary">+ New Chat</button>
                <div class="sidebar-header-buttons">
                    <button id="themeToggle" class="btn-icon" title="Toggle theme">üåô</button>
                    <button id="settingsBtn" class="btn-icon" title="Settings & Help">‚öôÔ∏è</button>
                </div>
            </div>
            
            <div class="sidebar-content">
                <!-- Conversation History -->
                <div class="history-panel">
                    <h3>Recent Conversations</h3>
                    <div id="conversationsList" class="conversations-list">
                        <!-- Populated dynamically -->
                    </div>
                </div>

                <!-- Templates -->
                <div class="templates-panel">
                    <h3>Templates</h3>
                    <select id="templateSelect" class="template-select">
                        <option value="">Custom conversation</option>
                    </select>
                </div>
                
                <!-- Settings Panel -->
                <div class="settings-panel">
                    <h3>Active Models</h3>
                    <div class="model-toggles" id="modelToggles">
                        <!-- Populated dynamically from server -->
                    </div>
                    
                    <h3>Mode</h3>
                    <select id="modeSelect" class="mode-select">
                        <option value="collaborate">ü§ù Collaborate</option>
                        <option value="debate">‚öîÔ∏è Debate</option>
                        <option value="personas">üé≠ Personas</option>
                    </select>
                    
                    <h3>Creativity</h3>
                    <div class="temperature-control">
                        <input type="range" id="temperatureSlider" min="0" max="1" step="0.1" value="0.7">
                        <div class="temperature-labels">
                            <span>Focused</span>
                            <span id="temperatureValue">0.7</span>
                            <span>Creative</span>
                        </div>
                    </div>
                    
                    <div id="personasPanel" class="personas-panel hidden">
                        <h4>Assign Roles</h4>
                        <div id="personaInputs"></div>
                    </div>
                </div>
                
                <!-- Search Panel -->
                <div class="search-panel">
                    <h3>Search</h3>
                    <input type="text" id="searchInput" placeholder="Search messages..." class="search-input">
                    <div id="searchResults" class="search-results hidden"></div>
                </div>
                
                <!-- Stats -->
                <div class="stats-panel">
                    <div class="stat">
                        <span class="stat-label">Messages</span>
                        <span id="messageCount" class="stat-value">0</span>
                    </div>
                    <div class="stat">
                        <span class="stat-label">Tokens</span>
                        <span id="tokenCount" class="stat-value">0</span>
                    </div>
                    <div class="stat">
                        <span class="stat-label">Cost</span>
                        <span id="costCount" class="stat-value">$0.00</span>
                    </div>
                </div>
                
                <!-- Actions -->
                <div class="actions-panel">
                    <button id="interactBtn" class="btn-secondary">ü§ù Make them interact</button>
                    <button id="synthesizeBtn" class="btn-secondary">üìù Synthesize discussion</button>
                    <button id="exportBtn" class="btn-secondary">üíæ Export to Markdown</button>
                </div>
            </div>
        </div>
        
        <!-- Main Chat Area -->
        <div class="chat-container">
            <div class="chat-header">
                <div class="chat-title">
                    <span id="chatTitle">Start a new conversation</span>
                </div>
                <div class="header-actions">
                    <button id="stopBtn" class="btn-stop hidden" title="Stop generation">
                        ‚èπÔ∏è Stop
                    </button>
                    <div class="thinking-indicators" id="thinkingIndicators"></div>
                </div>
            </div>
            
            <div class="messages-container" id="messagesContainer">
                <div class="welcome-message">
                    <h2>üëã Welcome to AI Brainstorm</h2>
                    <p>Have collaborative discussions with multiple AI models at once.</p>
                    <p>Models can see each other's responses and naturally build on ideas, disagree constructively, and ask each other questions.</p>
                    <div class="welcome-tips">
                        <h3>Try these modes:</h3>
                        <ul>
                            <li><strong>ü§ù Collaborate:</strong> Models work together to explore ideas</li>
                            <li><strong>‚öîÔ∏è Debate:</strong> Models take different perspectives and constructively challenge each other</li>
                            <li><strong>üé≠ Personas:</strong> Assign specific roles (e.g., "optimist", "devil's advocate", "technical expert")</li>
                        </ul>
                    </div>
                </div>
            </div>
            
            <div class="input-container">
                <div class="input-wrapper">
                    <textarea 
                        id="messageInput" 
                        placeholder="What would you like to brainstorm about?"
                        rows="1"
                    ></textarea>
                    <button id="sendBtn" class="btn-send">
                        <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <line x1="22" y1="2" x2="11" y2="13"></line>
                            <polygon points="22 2 15 22 11 13 2 9 22 2"></polygon>
                        </svg>
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Sidebar Overlay (Mobile) -->
    <div id="sidebarOverlay" class="sidebar-overlay"></div>

    <!-- Synthesis Modal -->
    <div id="synthesisModal" class="modal hidden">
        <div class="modal-content">
            <div class="modal-header">
                <h2>üìù Discussion Synthesis</h2>
                <button class="modal-close">&times;</button>
            </div>
            <div class="modal-body" id="synthesisContent">
                <div class="loading">Synthesizing conversation...</div>
            </div>
        </div>
    </div>
    
    <!-- Keyboard Shortcuts Modal -->
    <div id="shortcutsModal" class="modal hidden">
        <div class="modal-content">
            <div class="modal-header">
                <h2>‚å®Ô∏è Keyboard Shortcuts</h2>
                <button class="modal-close-shortcuts">&times;</button>
            </div>
            <div class="modal-body">
                <div class="shortcuts-list">
                    <div class="shortcut-item">
                        <kbd>Cmd/Ctrl</kbd> + <kbd>Enter</kbd>
                        <span>Send message</span>
                    </div>
                    <div class="shortcut-item">
                        <kbd>Cmd/Ctrl</kbd> + <kbd>K</kbd>
                        <span>Focus search</span>
                    </div>
                    <div class="shortcut-item">
                        <kbd>Cmd/Ctrl</kbd> + <kbd>N</kbd>
                        <span>New conversation</span>
                    </div>
                    <div class="shortcut-item">
                        <kbd>Cmd/Ctrl</kbd> + <kbd>I</kbd>
                        <span>Make models interact</span>
                    </div>
                    <div class="shortcut-item">
                        <kbd>Cmd/Ctrl</kbd> + <kbd>S</kbd>
                        <span>Synthesize discussion</span>
                    </div>
                    <div class="shortcut-item">
                        <kbd>Cmd/Ctrl</kbd> + <kbd>/</kbd>
                        <span>Show shortcuts</span>
                    </div>
                    <div class="shortcut-item">
                        <kbd>Esc</kbd>
                        <span>Close modal/clear search</span>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Settings Modal -->
    <div id="settingsModal" class="modal hidden">
        <div class="modal-content modal-large">
            <div class="modal-header">
                <h2>‚öôÔ∏è Settings & Help</h2>
                <button class="modal-close-settings">&times;</button>
            </div>
            <div class="modal-body">
                <div class="settings-tabs">
                    <button class="tab-btn active" data-tab="modes">Conversation Modes</button>
                    <button class="tab-btn" data-tab="technical">How Modes Work</button>
                    <button class="tab-btn" data-tab="models">Models</button>
                    <button class="tab-btn" data-tab="features">Features</button>
                </div>

                <!-- Modes Tab -->
                <div class="tab-content active" data-tab="modes">
                    <h3>üéØ Standard Modes</h3>
                    <div class="mode-card">
                        <h4>ü§ù Collaborate</h4>
                        <p>Models work together harmoniously, building on each other's ideas and exploring topics from complementary angles.</p>
                        <p><strong>Best for:</strong> Brainstorming, research, creative projects</p>
                    </div>
                    <div class="mode-card">
                        <h4>‚öîÔ∏è Debate</h4>
                        <p>Models take opposing viewpoints and challenge each other's arguments constructively.</p>
                        <p><strong>Best for:</strong> Evaluating decisions, exploring controversies, critical thinking</p>
                    </div>
                    <div class="mode-card">
                        <h4>üé≠ Personas</h4>
                        <p>Assign specific roles to each model (e.g., "optimist", "skeptic", "technical expert").</p>
                        <p><strong>Best for:</strong> Structured analysis, role-playing scenarios</p>
                    </div>

                    <h3>üß™ Experimental Modes</h3>
                    <div class="mode-card experimental">
                        <h4>üß™ Sequential</h4>
                        <p>Models respond one after another, each building on the previous response. Creates a flowing conversation where each model can see what others said.</p>
                        <p><strong>Best for:</strong> Building complex narratives, step-by-step problem solving</p>
                    </div>
                    <div class="mode-card experimental">
                        <h4>üé≤ Turn-Based</h4>
                        <p>Only one model responds per message, rotating through available models. Like taking turns in a conversation.</p>
                        <p><strong>Best for:</strong> Focused one-on-one style discussions, reducing information overload</p>
                    </div>
                    <div class="mode-card experimental">
                        <h4>üé§ Facilitator</h4>
                        <p>One model (Claude) leads the discussion and calls on other models by name to contribute.</p>
                        <p><strong>Best for:</strong> Structured meetings, guided exploration, interviews</p>
                    </div>
                    <div class="mode-card experimental">
                        <h4>‚öîÔ∏è Debate Rounds</h4>
                        <p>Structured debate format with opening statements, rebuttals, and closing arguments.</p>
                        <p><strong>Best for:</strong> Formal debates, competitive analysis, examining two sides</p>
                    </div>
                    <div class="mode-card experimental">
                        <h4>ü§î Socratic Method</h4>
                        <p>One model asks probing questions while another explores answers through dialogue.</p>
                        <p><strong>Best for:</strong> Deep philosophical exploration, teaching, self-discovery</p>
                    </div>
                </div>

                <!-- Technical Tab -->
                <div class="tab-content" data-tab="technical">
                    <h3>‚öôÔ∏è How Conversation Modes Work</h3>
                    <p class="intro-text">Understanding the technical differences between modes helps you choose the right one for your needs.</p>

                    <div class="technical-section">
                        <h4>üîÑ Execution Strategy</h4>
                        <div class="execution-grid">
                            <div class="execution-card">
                                <h5>Parallel Execution</h5>
                                <p><strong>Modes:</strong> Collaborate, Debate, Personas</p>
                                <p><strong>How it works:</strong> All active models receive your message simultaneously and respond at the same time. Responses appear as they stream in.</p>
                                <p><strong>Speed:</strong> ‚ö° Fastest - all models work concurrently</p>
                                <p><strong>Context:</strong> Models see your message only, not each other's responses (in that turn)</p>
                            </div>
                            <div class="execution-card">
                                <h5>Sequential Execution</h5>
                                <p><strong>Modes:</strong> Sequential, Facilitator, Socratic, Debate Rounds</p>
                                <p><strong>How it works:</strong> Models respond one after another with a 1.5-second delay between each. Each model sees previous responses in that turn.</p>
                                <p><strong>Speed:</strong> üê¢ Slower - models wait for each other</p>
                                <p><strong>Context:</strong> Each model sees all previous responses in the conversation thread</p>
                            </div>
                            <div class="execution-card">
                                <h5>Turn-Based Rotation</h5>
                                <p><strong>Modes:</strong> Turn-Based</p>
                                <p><strong>How it works:</strong> Only ONE model responds per message, rotating through your active models in sequence.</p>
                                <p><strong>Speed:</strong> ‚ö° Fast - single response per turn</p>
                                <p><strong>Context:</strong> The responding model sees the full conversation history</p>
                            </div>
                        </div>
                    </div>

                    <div class="technical-section">
                        <h4>üí≠ System Prompts & Instructions</h4>
                        <div class="prompt-examples">
                            <div class="prompt-card">
                                <h5>ü§ù Collaborate Mode</h5>
                                <code>You are participating in a collaborative brainstorming session with other AI models. Work together harmoniously, build on each other's ideas, and explore topics from complementary angles.</code>
                                <p><strong>Temperature:</strong> Uses your selected creativity setting</p>
                            </div>
                            <div class="prompt-card">
                                <h5>‚öîÔ∏è Debate Mode</h5>
                                <code>You are participating in a constructive debate with other AI models. Take opposing viewpoints, challenge arguments respectfully, and help explore different perspectives on the topic.</code>
                                <p><strong>Temperature:</strong> Uses your selected creativity setting</p>
                            </div>
                            <div class="prompt-card">
                                <h5>üé≠ Personas Mode</h5>
                                <code>Base instruction + your custom role assignment (e.g., "Act as a skeptical engineer who questions assumptions" or "Take the perspective of an optimistic entrepreneur")</code>
                                <p><strong>Temperature:</strong> Uses your selected creativity setting</p>
                            </div>
                            <div class="prompt-card">
                                <h5>üß™ Sequential Mode</h5>
                                <code>You are in a sequential discussion. Build thoughtfully on what previous models have said. You can agree, disagree, or add new angles.</code>
                                <p><strong>Temperature:</strong> 0.8 (higher creativity for narrative flow)</p>
                            </div>
                            <div class="prompt-card">
                                <h5>üé§ Facilitator Mode</h5>
                                <code>For Claude: "You are the facilitator. Guide the discussion and call on other models by name."<br>For others: Standard collaborative instructions</code>
                                <p><strong>Temperature:</strong> 0.7 (balanced)</p>
                            </div>
                            <div class="prompt-card">
                                <h5>ü§î Socratic Mode</h5>
                                <code>For questioner: "Ask probing, thoughtful questions to help explore the topic deeply."<br>For responder: "Answer thoughtfully and explore your reasoning."</code>
                                <p><strong>Temperature:</strong> 0.8 (encourages exploration)</p>
                            </div>
                        </div>
                    </div>

                    <div class="technical-section">
                        <h4>‚è±Ô∏è Timing & Delays</h4>
                        <table class="timing-table">
                            <tr>
                                <th>Mode</th>
                                <th>Delay Between Responses</th>
                                <th>Reason</th>
                            </tr>
                            <tr>
                                <td>Parallel modes</td>
                                <td>None (0ms)</td>
                                <td>All models work simultaneously</td>
                            </tr>
                            <tr>
                                <td>Sequential modes</td>
                                <td>1500ms (1.5s)</td>
                                <td>Gives time to read previous response</td>
                            </tr>
                            <tr>
                                <td>Turn-Based</td>
                                <td>None (0ms)</td>
                                <td>Only one model responds</td>
                            </tr>
                        </table>
                    </div>

                    <div class="technical-section">
                        <h4>üìä Response Limits</h4>
                        <div class="limits-grid">
                            <div class="limit-card">
                                <h5>Max Tokens per Response</h5>
                                <p><strong>All modes:</strong> 600 tokens</p>
                                <p>This keeps responses concise and conversation-friendly (roughly 1-2 paragraphs)</p>
                            </div>
                            <div class="limit-card">
                                <h5>Models per Turn</h5>
                                <p><strong>Parallel:</strong> All active models<br>
                                <strong>Sequential:</strong> All active models<br>
                                <strong>Turn-Based:</strong> 1 model only</p>
                            </div>
                            <div class="limit-card">
                                <h5>Conversation History</h5>
                                <p><strong>Storage:</strong> Up to 50 conversations in localStorage<br>
                                <strong>Context:</strong> Full message history sent to models</p>
                            </div>
                        </div>
                    </div>

                    <div class="technical-section">
                        <h4>üéØ @Mentions Override</h4>
                        <p class="info-text">In ANY mode, you can override which models respond by using @mentions:</p>
                        <ul class="mention-examples">
                            <li><code>@claude what's your take on this?</code> - Only Claude responds</li>
                            <li><code>@gemini @qwen compare your views</code> - Only Gemini and Qwen respond</li>
                            <li><code>What do you all think?</code> - All active models respond (default behavior)</li>
                        </ul>
                        <p class="info-text">This works regardless of the selected mode, giving you fine-grained control over the conversation.</p>
                    </div>

                    <div class="technical-section">
                        <h4>üîß Streaming & WebSockets</h4>
                        <div class="streaming-info">
                            <p><strong>Real-time streaming:</strong> Responses appear token-by-token as they're generated, not all at once.</p>
                            <p><strong>Technology:</strong> Server-Sent Events (SSE) from OpenRouter API + WebSocket broadcasting to your browser</p>
                            <p><strong>Visual feedback:</strong> Blinking cursor (‚ñä) shows active streaming, thinking indicators show which models are working</p>
                            <p><strong>Stop button:</strong> Click the red "Stop" button anytime to halt all ongoing generations</p>
                        </div>
                    </div>
                </div>

                <!-- Models Tab -->
                <div class="tab-content" data-tab="models">
                    <h3>Available Models</h3>
                    <div id="modelsList" class="models-list">
                        <!-- Populated dynamically -->
                    </div>
                    <div class="info-box">
                        <p><strong>üí° Tip:</strong> Use @mentions to target specific models in any conversation!</p>
                        <p>Example: <code>@claude what do you think?</code> or <code>@qwen @phi compare your views</code></p>
                    </div>
                </div>

                <!-- Features Tab -->
                <div class="tab-content" data-tab="features">
                    <h3>Key Features</h3>
                    <div class="feature-card">
                        <h4>üí¨ @Mentions</h4>
                        <p>Target specific models by typing <code>@modelname</code> in your message. Only mentioned models will respond.</p>
                    </div>
                    <div class="feature-card">
                        <h4>üìù Templates</h4>
                        <p>Pre-configured conversation setups for common scenarios (brainstorming, debates, research, etc.)</p>
                    </div>
                    <div class="feature-card">
                        <h4>üé≠ Historical Figures</h4>
                        <p>Chat with AI versions of Einstein, Curie, da Vinci, and other historical personalities.</p>
                    </div>
                    <div class="feature-card">
                        <h4>üìÇ GitHub Analysis</h4>
                        <p>Paste a GitHub URL to have models analyze the repository collaboratively.</p>
                    </div>
                    <div class="feature-card">
                        <h4>üëç Reactions & Voting</h4>
                        <p>React to messages and vote for the best responses to track what resonates.</p>
                    </div>
                    <div class="feature-card">
                        <h4>üîç Search</h4>
                        <p>Search through conversation history to find specific messages or topics.</p>
                    </div>
                    <div class="feature-card">
                        <h4>üíæ Export</h4>
                        <p>Export entire conversations to Markdown format for documentation.</p>
                    </div>
                    <div class="feature-card">
                        <h4>‚å®Ô∏è Keyboard Shortcuts</h4>
                        <p>Press <kbd>Cmd/Ctrl</kbd> + <kbd>/</kbd> to see all available shortcuts.</p>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
    <script src="app.js"></script>
</body>
</html>
